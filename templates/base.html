<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}Lucky Ledger{% endblock %}</title>

    <!-- Google Fonts - Warm, friendly typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        terracotta: {
                            50: '#FEF5F2',
                            100: '#FCEAE4',
                            200: '#F8D5C9',
                            300: '#E8A88B',
                            400: '#D88B6A',
                            500: '#C67B5C',
                            600: '#A85D3F',
                            700: '#8A4A32',
                            800: '#6D3B28',
                            900: '#5A3222'
                        },
                        sage: {
                            50: '#F4F8F4',
                            100: '#E8F1E7',
                            200: '#D1E3CF',
                            300: '#B8D4B5',
                            400: '#9FC59C',
                            500: '#8FAE8B',
                            600: '#5F7D5B',
                            700: '#4A6247',
                            800: '#3A4D38',
                            900: '#2D3D2C'
                        },
                        cream: {
                            50: '#FFFDFB',
                            100: '#FDF8F3',
                            200: '#F5EDE4',
                            300: '#EBE3D8',
                            400: '#DDD2C4'
                        },
                        amber: {
                            50: '#FFFBF0',
                            100: '#FEF5DC',
                            200: '#F5D590',
                            300: '#E5A853',
                            400: '#D49A3D',
                            500: '#C08830'
                        },
                        rose: {
                            50: '#FDF6F6',
                            100: '#FAE9E9',
                            200: '#EDCFCF',
                            300: '#D4A5A5',
                            400: '#C28585',
                            500: '#B87070',
                            600: '#9A5555'
                        },
                        warm: {
                            50: '#FAF9F7',
                            100: '#EBE7E1',
                            200: '#DDD7CE',
                            300: '#C9C2B8',
                            400: '#A69E92',
                            500: '#8B8279',
                            600: '#6E665D',
                            700: '#5C554D',
                            800: '#454038',
                            900: '#3D3833'
                        }
                    },
                    fontFamily: {
                        'display': ['Quicksand', 'sans-serif'],
                        'body': ['Nunito', 'sans-serif']
                    },
                    animation: {
                        'bounce-gentle': 'bounce-gentle 2s ease-in-out infinite',
                        'wiggle': 'wiggle 0.5s ease-in-out',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out'
                    },
                    keyframes: {
                        'bounce-gentle': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        },
                        'wiggle': {
                            '0%, 100%': { transform: 'rotate(0deg)' },
                            '25%': { transform: 'rotate(-3deg)' },
                            '75%': { transform: 'rotate(3deg)' }
                        },
                        'fadeIn': {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        'slideUp': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        'scaleIn': {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Alpine.js for dropdown interactions -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Custom styles -->
    <style>
        body {
            font-family: 'Nunito', sans-serif;
        }
        h1, h2, h3, .font-display {
            font-family: 'Quicksand', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F5EDE4;
        }
        ::-webkit-scrollbar-thumb {
            background: #C9C2B8;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #A69E92;
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>
{% from "_icons.html" import icon %}
<body class="bg-cream-100 text-warm-900">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-sm shadow-sm border-b border-warm-200 sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <!-- Logo -->
                <a href="/" class="flex items-center gap-2 group">
                    <!-- Lucky Ledger Cat Logo -->
                    <img src="{{ url_for('static', filename='images/header-logo.png') }}" alt="Lucky Ledger" class="w-10 h-10">
                    <h1 class="text-xl font-bold font-display text-warm-800 group-hover:text-terracotta-600 transition-colors">
                        Lucky Ledger
                    </h1>
                </a>

                <div class="flex items-center gap-6">
                    <!-- Nav Links -->
                    <div class="hidden md:flex gap-1">
                        <a href="/" class="relative px-3 py-2 text-warm-600 hover:text-terracotta-600 font-medium transition-colors group">
                            <span class="flex items-center gap-1.5">
                                <img src="{{ url_for('static', filename='images/cat-ledger.png') }}" alt="" class="w-5 h-5">
                                <span>Transactions</span>
                            </span>
                            <span class="absolute bottom-0 left-3 right-3 h-0.5 bg-terracotta-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></span>
                        </a>
                        <a href="/reconciliation" class="relative px-3 py-2 text-warm-600 hover:text-terracotta-600 font-medium transition-colors group">
                            <span class="flex items-center gap-1.5">
                                <img src="{{ url_for('static', filename='images/cat-highfive.png') }}" alt="" class="w-5 h-5">
                                <span>Reconciliation</span>
                            </span>
                            <span class="absolute bottom-0 left-3 right-3 h-0.5 bg-terracotta-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></span>
                        </a>
                        <a href="/budget" class="relative px-3 py-2 text-warm-600 hover:text-terracotta-600 font-medium transition-colors group">
                            <span class="flex items-center gap-1.5">
                                <img src="{{ url_for('static', filename='images/cat-coins.png') }}" alt="" class="w-5 h-5">
                                <span>Budget</span>
                            </span>
                            <span class="absolute bottom-0 left-3 right-3 h-0.5 bg-terracotta-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></span>
                        </a>
                        <a href="/household/settings" class="relative px-3 py-2 text-warm-600 hover:text-terracotta-600 font-medium transition-colors group">
                            <span class="flex items-center gap-1.5">
                                <img src="{{ url_for('static', filename='images/cat-gear.png') }}" alt="" class="w-5 h-5">
                                <span>Settings</span>
                            </span>
                            <span class="absolute bottom-0 left-3 right-3 h-0.5 bg-terracotta-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></span>
                        </a>
                    </div>

                    {% if current_user.is_authenticated %}
                        <!-- Desktop: Full user info -->
                        <div class="hidden sm:flex items-center gap-3 pl-4 border-l border-warm-200">
                            <!-- Household Switcher -->
                            {% if current_user.household_memberships|length > 1 %}
                            <div class="relative" x-data="{ open: false }">
                                <button @click="open = !open"
                                        class="flex items-center gap-2 px-3 py-1.5 rounded-xl bg-cream-200 hover:bg-cream-300 text-warm-700 text-sm font-medium transition-colors">
                                    {{ icon('cat-house', size='sm') }}
                                    <span>{{ current_household.name if current_household else 'Select Household' }}</span>
                                    <svg class="w-4 h-4 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div x-show="open"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-150"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     @click.away="open = false"
                                     class="absolute right-0 mt-2 w-56 bg-white rounded-2xl shadow-lg border border-warm-200 py-2 z-50">
                                    {% for membership in current_user.household_memberships %}
                                    <form method="POST" action="{{ url_for('household.switch_household', household_id=membership.household.id) }}">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="flex items-center justify-between w-full px-4 py-2.5 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                            <span class="flex items-center gap-2">
                                                {{ icon('cat-house', size='sm') }}
                                                <span>{{ membership.household.name }}</span>
                                            </span>
                                            {% if current_household and membership.household.id == current_household.id %}
                                            <span class="text-sage-500 text-lg">✓</span>
                                            {% endif %}
                                        </button>
                                    </form>
                                    {% endfor %}
                                    <hr class="my-2 border-warm-100">
                                    <a href="{{ url_for('household.create_household') }}" class="flex items-center gap-2 px-4 py-2.5 text-sm text-terracotta-600 hover:bg-terracotta-50 transition-colors">
                                        {{ icon('cat-sparkle', size='sm') }}
                                        <span>Create New Household</span>
                                    </a>
                                </div>
                            </div>
                            {% else %}
                            <span class="flex items-center gap-1.5 text-sm text-warm-500">
                                {{ icon('cat-house', size='sm') }}
                                <span>{{ current_household.name if current_household else '' }}</span>
                            </span>
                            {% endif %}

                            <!-- User Dropdown -->
                            <div class="relative" x-data="{ open: false }">
                                <button @click="open = !open"
                                        class="flex items-center gap-2 px-3 py-1.5 rounded-xl bg-cream-200 hover:bg-cream-300 text-warm-700 text-sm font-medium transition-colors">
                                    <div class="w-7 h-7 bg-terracotta-100 rounded-lg flex items-center justify-center">
                                        <span class="text-terracotta-600 font-bold text-sm">{{ current_user.name[0].upper() }}</span>
                                    </div>
                                    <span>{{ current_user.name }}</span>
                                    <svg class="w-4 h-4 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div x-show="open"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-150"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     @click.away="open = false"
                                     class="absolute right-0 mt-2 w-48 bg-white rounded-2xl shadow-lg border border-warm-200 py-2 z-50">
                                    <a href="{{ url_for('profile.profile') }}" class="flex items-center gap-2 px-4 py-2.5 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                        {{ icon('cat-face', size='sm') }}
                                        <span>Profile</span>
                                    </a>
                                    <hr class="my-2 border-warm-100">
                                    <a href="/logout" class="flex items-center gap-2 px-4 py-2.5 text-sm text-rose-500 hover:bg-rose-50 transition-colors">
                                        {{ icon('cat-wave', size='sm') }}
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Mobile: Compact menu -->
                        <div class="sm:hidden relative" x-data="{ open: false }">
                            <button @click="open = !open"
                                    class="flex items-center gap-2 px-3 py-2 rounded-xl bg-cream-200 hover:bg-cream-300 text-warm-700 font-medium transition-colors">
                                {{ icon('cat-menu', size='md') }}
                            </button>
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95"
                                 x-transition:enter-end="opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100"
                                 x-transition:leave-end="opacity-0 scale-95"
                                 @click.away="open = false"
                                 class="absolute right-0 mt-2 w-64 bg-white rounded-2xl shadow-lg border border-warm-200 py-2 z-50">
                                <!-- User info -->
                                <div class="px-4 py-3 border-b border-warm-100">
                                    <div class="font-semibold text-warm-800">{{ current_user.name }}</div>
                                    <div class="text-xs text-warm-400">{{ current_household.name if current_household else '' }}</div>
                                </div>
                                <!-- Navigation -->
                                <div class="py-2">
                                    <a href="/" class="flex items-center gap-3 px-4 py-2.5 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                        {{ icon('cat-ledger', size='md') }}
                                        <span>Transactions</span>
                                    </a>
                                    <a href="/reconciliation" class="flex items-center gap-3 px-4 py-2.5 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                        {{ icon('cat-highfive', size='md') }}
                                        <span>Reconciliation</span>
                                    </a>
                                    <a href="/budget" class="flex items-center gap-3 px-4 py-2.5 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                        {{ icon('cat-coins', size='md') }}
                                        <span>Budget</span>
                                    </a>
                                    <a href="/household/settings" class="flex items-center gap-3 px-4 py-2.5 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                        {{ icon('cat-gear', size='md') }}
                                        <span>Settings</span>
                                    </a>
                                </div>
                                <!-- Household switcher (if multiple) -->
                                {% if current_user.household_memberships|length > 1 %}
                                <div class="border-t border-warm-100 py-2">
                                    <div class="px-4 py-1 text-xs font-semibold text-warm-400 uppercase">Switch Household</div>
                                    {% for membership in current_user.household_memberships %}
                                    <form method="POST" action="{{ url_for('household.switch_household', household_id=membership.household.id) }}">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="flex items-center justify-between w-full px-4 py-2 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                            <span class="flex items-center gap-2">
                                                {{ icon('cat-house', size='sm') }}
                                                <span>{{ membership.household.name }}</span>
                                            </span>
                                            {% if current_household and membership.household.id == current_household.id %}
                                            <span class="text-sage-500">✓</span>
                                            {% endif %}
                                        </button>
                                    </form>
                                    {% endfor %}
                                </div>
                                {% endif %}
                                <!-- Profile & Logout -->
                                <div class="border-t border-warm-100 pt-2">
                                    <a href="{{ url_for('profile.profile') }}" class="flex items-center gap-3 px-4 py-2.5 text-sm text-warm-700 hover:bg-cream-100 transition-colors">
                                        {{ icon('cat-face', size='md') }}
                                        <span>Profile</span>
                                    </a>
                                    <a href="/logout" class="flex items-center gap-3 px-4 py-2.5 text-sm text-rose-500 hover:bg-rose-50 transition-colors">
                                        {{ icon('cat-wave', size='md') }}
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-5 sm:px-8 py-6">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-6 space-y-3">
                    {% for category, message in messages %}
                        <div class="p-4 rounded-2xl flex items-start gap-3 animate-slide-up
                            {% if category == 'success' %}bg-sage-50 text-sage-800 border border-sage-200
                            {% elif category == 'danger' %}bg-rose-50 text-rose-600 border border-rose-200
                            {% elif category == 'warning' %}bg-amber-50 text-amber-500 border border-amber-200
                            {% else %}bg-terracotta-50 text-terracotta-700 border border-terracotta-200{% endif %}">
                            <span class="text-lg">
                                {% if category == 'success' %}{{ icon('cat-happy', size='lg') }}
                                {% elif category == 'danger' %}{{ icon('cat-worried', size='lg') }}
                                {% elif category == 'warning' %}{{ icon('cat-alert', size='lg') }}
                                {% else %}{{ icon('cat-lightbulb', size='lg') }}{% endif %}
                            </span>
                            <span class="font-medium">{{ message }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="mt-16 py-8 text-center border-t border-warm-200">
        <p class="text-warm-400 text-sm flex items-center justify-center gap-2">
            <span>Made with</span>
            <span class="text-rose-400">{{ icon('cat-heart', size='md') }}</span>
            <span>for families everywhere</span>
        </p>
        <p class="text-warm-300 text-xs mt-1">Lucky Ledger © 2026</p>
    </footer>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
