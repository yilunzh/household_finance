{% extends "base.html" %}
{% from "_icons.html" import icon %}

{% block title %}Invite Partner - Lucky Ledger{% endblock %}

{% block content %}
<div class="max-w-lg mx-auto animate-fade-in">
    <div class="bg-white rounded-3xl shadow-lg border border-warm-200 p-8 relative overflow-hidden">
        <!-- Decorative corner -->
        <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-bl from-terracotta-100 to-transparent rounded-bl-full opacity-60"></div>

        <!-- Illustration -->
        <div class="flex justify-center mb-6 relative">
            <svg class="w-24 h-24 text-terracotta-400" viewBox="0 0 100 100" fill="none">
                <!-- Envelope -->
                <rect x="15" y="30" width="70" height="50" rx="4" stroke="currentColor" stroke-width="3" fill="none"/>
                <path d="M15 35L50 60L85 35" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Hearts floating -->
                <path d="M25 20C25 17 22 15 20 18C19 20 19 24 25 28C31 24 31 20 30 18C28 15 25 17 25 20Z" fill="currentColor" opacity="0.4"/>
                <path d="M75 15C75 13 73 12 72 13C71.5 14 71.5 16 75 18C78.5 16 78.5 14 78 13C77 12 75 13 75 15Z" fill="currentColor" opacity="0.3"/>
                <path d="M60 25C60 23 58 22 57 23C56.5 24 56.5 26 60 28C63.5 26 63.5 24 63 23C62 22 60 23 60 25Z" fill="currentColor" opacity="0.35"/>
            </svg>
        </div>

        <h2 class="text-2xl font-bold font-display text-center text-warm-800 mb-2 flex items-center justify-center gap-2">
            {{ icon('cat-envelope', size='lg') }}
            <span>Invite Your Partner</span>
        </h2>
        <p class="text-center text-warm-500 mb-8">
            Send an invitation to join "{{ household.name }}"
        </p>

        <form method="POST" action="{{ url_for('invitations.send_invitation') }}" class="space-y-5">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div>
                <label for="email" class="block text-sm font-semibold text-warm-700 mb-2">
                    Partner's Email Address
                </label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    autocomplete="email"
                    placeholder="partner@example.com"
                    class="w-full px-4 py-3 bg-cream-50 border-2 border-warm-200 rounded-xl
                           focus:border-terracotta-400 focus:ring-4 focus:ring-terracotta-100
                           placeholder-warm-400 text-warm-800 transition-all duration-200"
                >
                <p class="mt-2 text-sm text-warm-400 flex items-center gap-1">
                    {{ icon('cat-envelope', size='sm') }}
                    <span>They'll receive an email with a link to join</span>
                </p>
            </div>

            <div>
                <label for="display_name" class="block text-sm font-semibold text-warm-700 mb-2">
                    Display Name (optional)
                </label>
                <input
                    type="text"
                    id="display_name"
                    name="display_name"
                    placeholder="e.g., Alex, Partner"
                    maxlength="50"
                    class="w-full px-4 py-3 bg-cream-50 border-2 border-warm-200 rounded-xl
                           focus:border-terracotta-400 focus:ring-4 focus:ring-terracotta-100
                           placeholder-warm-400 text-warm-800 transition-all duration-200"
                >
                <p class="mt-2 text-sm text-warm-400 flex items-center gap-1">
                    {{ icon('cat-sparkle', size='sm') }}
                    <span>How their name will appear (they can change it later)</span>
                </p>
            </div>

            <button
                type="submit"
                class="w-full bg-terracotta-500 text-white py-3.5 px-4 rounded-xl
                       hover:bg-terracotta-600 active:bg-terracotta-700
                       focus:ring-4 focus:ring-terracotta-200
                       font-semibold text-lg shadow-sm hover:shadow-md
                       transform hover:-translate-y-0.5 active:translate-y-0
                       transition-all duration-200"
            >
                Send Invitation
            </button>
        </form>

        {% if pending_invitations %}
        <div class="mt-8 pt-6 border-t border-warm-100">
            <h3 class="text-lg font-semibold text-warm-700 mb-4 flex items-center gap-2">
                {{ icon('cat-clock', size='lg') }}
                <span>Pending Invitations</span>
            </h3>
            <div class="space-y-3">
                {% for invite in pending_invitations %}
                <div class="flex items-center justify-between p-3 bg-amber-50 border border-amber-200 rounded-xl">
                    <div>
                        <span class="font-medium text-warm-700">{{ invite.email }}</span>
                        <span class="text-sm text-warm-400 ml-2">
                            (sent {{ invite.created_at.strftime('%b %d, %Y') }})
                        </span>
                    </div>
                    <form method="POST" action="{{ url_for('invitations.cancel_invitation', invitation_id=invite.id) }}" class="inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="text-sm text-rose-500 hover:text-rose-600 font-medium transition-colors">
                            Cancel
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="mt-8 text-center">
            <a href="/" class="text-warm-500 hover:text-terracotta-600 font-medium transition-colors">
                ‚Üê Back to Transactions
            </a>
        </div>
    </div>

    {% if not mail_configured %}
    <div class="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-2xl">
        <p class="text-sm text-amber-700 flex items-center gap-2">
            {{ icon('cat-lightbulb', size='md') }}
            <span><strong>Note:</strong> Email not configured. The invitation link will be displayed instead of emailed.</span>
        </p>
    </div>
    {% endif %}
</div>
{% endblock %}
