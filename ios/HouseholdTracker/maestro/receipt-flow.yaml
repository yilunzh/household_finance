appId: com.householdtracker.app
---
# Receipt Flow E2E Test
# Tests viewing transaction details and receipt functionality

- launchApp:
    clearState: true
    arguments:
      MAESTRO_TEST: true

# Test mode auto-login handles authentication
# Wait for Transactions screen to appear
- extendedWaitUntil:
    visible: "Transactions"
    timeout: 10000

# Small gesture to ensure UI is responsive
- swipe:
    direction: UP
    duration: 100

# Verify we have transactions loaded (wait for a transaction to appear)
- extendedWaitUntil:
    visible: "January 2026"
    timeout: 3000

# Tap on a transaction (Safeway has receipt data)
- tapOn:
    text: "Safeway"
    retryTapIfNoChange: true

# Verify transaction detail view opened
- extendedWaitUntil:
    visible: "Details"
    timeout: 2000

# Verify the Receipt section is visible
- assertVisible: "Receipt"

# Check if there's an existing receipt or option to add one
- runFlow:
    when:
      visible: "View Receipt"
    file: helpers/receipt-view-helper.yaml

# If no receipt, verify "Add Receipt Photo" option exists
- runFlow:
    when:
      visible: "Add Receipt Photo"
    commands:
      - assertVisible: "Add Receipt Photo"

# Close the detail view (swipe down to dismiss sheet)
- swipe:
    direction: DOWN
    duration: 500

# Verify we're back on transactions list
- extendedWaitUntil:
    visible: "Transactions"
    timeout: 3000
