appId: com.householdtracker.app
---
# Receipt Flow E2E Test
# Tests viewing transaction details and receipt functionality

- launchApp:
    clearState: true

# Check if already logged in (might have keychain tokens)
- runFlow:
    when:
      visible: "Transactions"
    file: helpers/logout-helper.yaml

# Login first
- assertVisible: "Lucky Ledger"
- tapOn: "your@email.com"
- inputText: "demo_alice@example.com"
- tapOn: "Your password"
- inputText: "password123"
- tapOn: "Log In"

# Wait for transactions to load
- extendedWaitUntil:
    visible: "Transactions"
    timeout: 10000

# Small gesture to ensure UI is responsive
- swipe:
    direction: UP
    duration: 100

# Verify we have transactions loaded (wait for a transaction to appear)
- extendedWaitUntil:
    visible: "January 2026"
    timeout: 5000

# Tap on a transaction (Safeway has receipt data)
- tapOn:
    text: "Safeway"
    retryTapIfNoChange: true

# Verify transaction detail view opened
- extendedWaitUntil:
    visible: "Details"
    timeout: 3000

# Verify the Receipt section is visible
- assertVisible: "Receipt"

# Check if there's an existing receipt or option to add one
- runFlow:
    when:
      visible: "View Receipt"
    file: helpers/receipt-view-helper.yaml

# If no receipt, verify "Add Receipt Photo" option exists
- runFlow:
    when:
      visible: "Add Receipt Photo"
    commands:
      - assertVisible: "Add Receipt Photo"

# Close the detail view
- tapOn: "Done"

# Verify we're back on transactions list
- assertVisible: "Transactions"
