appId: com.householdtracker.app
---
# Add Transaction E2E Test
- launchApp:
    clearState: true

# Check if already logged in (might have keychain tokens)
- runFlow:
    when:
      visible: "Transactions"
    file: helpers/logout-helper.yaml

# Login using helper
- assertVisible: "Lucky Ledger"
- runFlow:
    file: helpers/do-login.yaml

# Small gesture to ensure UI is responsive
- swipe:
    direction: UP
    duration: 100

# Tap add button (+ icon in top right, has accessibilityLabel "Add Transaction")
- tapOn:
    text: "Add Transaction"
    retryTapIfNoChange: true

# Fill in transaction details - wait for sheet to appear
- extendedWaitUntil:
    visible: "Where did you spend?"
    timeout: 3000

# Tap merchant field by placeholder text
- tapOn: "Where did you spend?"
- inputText: "Test Groceries"

# Amount field - tap on the amount display area
- tapOn:
    text: "0.00"
    index: 0
- inputText: "50"

# Take screenshot to verify amount formatting
- takeScreenshot: "add-transaction-amount"

# Hide keyboard by tapping elsewhere
- hideKeyboard

# Scroll down to see more fields and the save button
- scrollUntilVisible:
    element: "Paid By"
    direction: DOWN
    timeout: 2000

# Select Paid By (required field)
- tapOn: "Paid By"

# Wait for picker and select Alice
- extendedWaitUntil:
    visible: "Alice"
    timeout: 2000
- tapOn: "Alice"

# Hide keyboard/picker if visible
- hideKeyboard

# Scroll to save button
- scrollUntilVisible:
    element: "Add Transaction"
    direction: DOWN
    timeout: 2000

# Submit the transaction (button text is "Add Transaction")
- tapOn:
    text: "Add Transaction"
    index: 1

# Wait for the sheet to dismiss and return to transactions list
- extendedWaitUntil:
    visible: "Transactions"
    timeout: 7000
